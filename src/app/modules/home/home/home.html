<div class="home-container relative">
    <canvas #canvas></canvas>
    
    <!-- Overlay de introducción -->
     @if(showIntroOverlay){
      <div 
        class="intro-overlay fixed inset-0 flex items-center justify-center bg-gradient-to-b from-black via-gray-900 to-black text-white cursor-pointer select-none transition-opacity duration-700 z-40" 
        (click)="hideIntroOverlay()"
      >
        <div class="text-center space-y-6 animate-fade-in">
          <h1 class="text-6xl font-bold bg-gradient-to-r from-green-400 via-emerald-500 to-teal-500 bg-clip-text text-transparent animate-pulse">
            PUZZLE MAKERS
          </h1>
          <p class="text-xl text-gray-300">Descubre un mundo de conocimiento ambiental</p>
          <div class="flex items-center justify-center gap-3 text-lg animate-bounce">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path>
            </svg>
            <span>Haz clic para continuar</span>
          </div>
        </div>
      </div>
  
     }
    
    <!-- Header flotante superior -->
    <header class="fixed top-0 left-0 right-0 z-30 bg-gradient-to-b from-black/60 to-transparent backdrop-blur-sm">
      <div class="container mx-auto px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
          <div class="w-32 flex items-center justify-center">
            <img src="logo.png" alt="">
          </div>
          <!-- <span class="text-white font-bold text-xl">Puzzle Makers</span> -->
        </div>
        
        <nav class="hidden md:flex gap-6 text-white/80">
          <a href="#" class="hover:text-white transition-colors">Inicio</a>
          <a href="#" class="hover:text-white transition-colors">Explorar</a>
          <a href="#" class="hover:text-white transition-colors">Aprende</a>
          <a href="#" class="hover:text-white transition-colors">Comunidad</a>
        </nav>

        <div class="flex items-center gap-3">
          <!-- Control de audio -->
          <button 
            (click)="toggleMute()" 
            class="w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 backdrop-blur-sm flex items-center justify-center text-white transition-all duration-300 hover:scale-110">
            @if(!isMuted){
              <svg  class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z" clip-rule="evenodd"></path>
              </svg>
            }
            
            @if(isMuted){
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
            }
            
          </button>

          <!-- <button class="px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-full hover:shadow-lg transition-all duration-300 hover:scale-105 font-semibold text-sm">
            Iniciar Sesión
          </button> -->
        </div>
      </div>
    </header>
    
    <!-- Instrucción central principal -->
     @if(!isZooming){
      <div class="instruction absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20 text-center pointer-events-none">

      </div>

     }
    
    @if(!isZooming && !showIntroOverlay){
      <!-- Panel de estadísticas flotante (lado izquierdo) -->
      <div class="fixed left-6 top-1/2 transform -translate-y-1/2 z-30 space-y-4" >
        <!-- Card de jugadores online -->
        <div class="bg-white/10 backdrop-blur-md rounded-2xl p-4 border border-white/20 shadow-xl hover:bg-white/15 transition-all duration-300">
          <div class="flex items-center gap-3 text-white">
            <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-emerald-600 rounded-full flex items-center justify-center">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
              </svg>
            </div>
            <div>
              <p class="text-xs text-white/60 uppercase font-semibold">Jugadores</p>
              <p class="text-2xl font-bold">1,234</p>
            </div>
          </div>
        </div>

        <!-- Card de retos completados -->
        <div class="bg-white/10 backdrop-blur-md rounded-2xl p-4 border border-white/20 shadow-xl hover:bg-white/15 transition-all duration-300">
          <div class="flex items-center gap-3 text-white">
            <div class="w-12 h-12 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
              </svg>
            </div>
            <div>
              <p class="text-xs text-white/60 uppercase font-semibold">Retos</p>
              <p class="text-2xl font-bold">856</p>
            </div>
          </div>
        </div>

        <!-- Card de árboles salvados -->
        <div class="bg-white/10 backdrop-blur-md rounded-2xl p-4 border border-white/20 shadow-xl hover:bg-white/15 transition-all duration-300">
          <div class="flex items-center gap-3 text-white">
            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center">
              <span class="text-2xl">🌳</span>
            </div>
            <div>
              <p class="text-xs text-white/60 uppercase font-semibold">Árboles</p>
              <p class="text-2xl font-bold">12.5K</p>
            </div>
          </div>
        </div>
      </div>

      <button (click)="startJourney()"
        class="absolute left-1/2 top-3/4 transform -translate-x-1/2 -translate-y-1/2
              bg-transparent border border-white text-white px-6 py-3 rounded-md
              hover:bg-white/90 hover:text-black shadow-md hover:shadow-lg
              transition-all duration-500 ease-in-out cursor-pointer"
      >
        Iniciar Viaje
      </button>

    }

    @if(!isZooming && !showIntroOverlay){
    <!-- Indicadores de características (lado derecho inferior) -->
    <div class="fixed right-6 bottom-6 z-30 space-y-3">
      <div class="bg-gradient-to-r from-blue-500/20 to-purple-500/20 backdrop-blur-md rounded-xl px-4 py-3 border border-white/20 flex items-center gap-2 text-white text-sm font-semibold animate-pulse">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
        </svg>
        <span>Mundo 3D Interactivo</span>
      </div>
      
      <div class="bg-gradient-to-r from-green-500/20 to-emerald-500/20 backdrop-blur-md rounded-xl px-4 py-3 border border-white/20 flex items-center gap-2 text-white text-sm font-semibold">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"></path>
        </svg>
        <span>Aprende Jugando</span>
      </div>
      
      <div class="bg-gradient-to-r from-yellow-500/20 to-orange-500/20 backdrop-blur-md rounded-xl px-4 py-3 border border-white/20 flex items-center gap-2 text-white text-sm font-semibold">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"></path>
        </svg>
        <span>Salva el Planeta</span>
      </div>
    </div>
    }

  
    @if(isZooming){
      <!-- Mensaje durante el zoom -->
      <div class="zooming-message fixed inset-0 flex flex-col items-center justify-center bg-black/90 backdrop-blur-lg z-50 text-white">
        <div class="text-center space-y-6 animate-fade-in">
          <div class="loading-spinner w-16 h-16 border-4 border-green-500/30 border-t-green-500 rounded-full animate-spin mx-auto"></div>
          <div class="space-y-2">
            <p class="text-2xl font-bold">Viajando a Santa María del Mar...</p>
            <p class="text-gray-400">Preparando tu aventura ambiental</p>
          </div>
          <div class="flex items-center justify-center gap-2 text-green-400">
            <div class="w-2 h-2 bg-green-400 rounded-full animate-bounce"></div>
            <div class="w-2 h-2 bg-green-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
            <div class="w-2 h-2 bg-green-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
          </div>
        </div>
      </div>
    }


    @if(!isZooming && !showIntroOverlay){
      <!-- Controles de navegación 3D (esquina inferior izquierda) -->
      <div class="fixed left-6 bottom-6 z-30 bg-white/10 backdrop-blur-md rounded-xl p-3 border border-white/20" >
        <div class="text-white text-xs space-y-2">
          <div class="flex items-center gap-2">
            <kbd class="px-2 py-1 bg-white/20 rounded text-xs font-mono">W A S D</kbd>
            <span>Mover</span>
          </div>
          <div class="flex items-center gap-2">
            <kbd class="px-2 py-1 bg-white/20 rounded text-xs font-mono">Mouse</kbd>
            <span>Rotar cámara</span>
          </div>
          <div class="flex items-center gap-2">
            <kbd class="px-2 py-1 bg-white/20 rounded text-xs font-mono">Click</kbd>
            <span>Interactuar</span>
          </div>
        </div>
      </div>
    }


    <!-- Footer informativo -->
     @if(!isZooming && !showIntroOverlay){
    <footer class="fixed bottom-0 left-0 right-0 z-20 bg-gradient-to-t from-black/60 to-transparent backdrop-blur-sm">
      <div class="container mx-auto px-6 py-3 flex justify-between items-center text-white/60 text-xs">
        <div class="flex items-center gap-2">
          <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
          <span>Sistema activo</span>
        </div>
        <div class="hidden md:flex gap-6">
          <span>© 2025 Puzzle Makers</span>
          <span>•</span>
          <a href="#" class="hover:text-white transition-colors">Términos</a>
          <span>•</span>
          <a href="#" class="hover:text-white transition-colors">Privacidad</a>
          <span>•</span>
          <a href="#" class="hover:text-white transition-colors">Soporte</a>
          <!-- <span>•</span>
          <a href="#" class="hover:text-white transition-colors">author: Franklin Cruz Hurtado</a> -->
        </div>
        <div class="flex items-center gap-2">
          <span>Versión 1.0.0</span>
        </div>
      </div>
    </footer>
     }

  </div>
  
  <!-- Audio player -->
  <audio #audioPlayer [src]="audioUrl" loop [muted]="isMuted"></audio>
  
  <!-- Prompt para desmutear -->
   @if(showUnmutePrompt){
    <div class="unmute-overlay fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center" (click)="unmute()">
      <div class="bg-white rounded-2xl p-8 max-w-md text-center space-y-4 transform hover:scale-105 transition-transform">
        <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-emerald-600 rounded-full flex items-center justify-center mx-auto">
          <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <h3 class="text-2xl font-bold text-gray-900">¿Activar música ambiental?</h3>
        <p class="text-gray-600">Disfruta de una experiencia inmersiva con sonidos de la naturaleza</p>
        <button class="w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-semibold hover:shadow-lg transition-all duration-300 hover:scale-105">
          Activar Audio 🔊
        </button>
      </div>
    </div>
   }


  <style>
    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in {
      animation: fade-in 0.6s ease-out;
    }

    @keyframes bounce {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    .loading-spinner {
      border-top-color: currentColor;
    }

    kbd {
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
  </style>